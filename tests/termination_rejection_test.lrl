;; Test file for Phase 1D: Termination Rejection
;;
;; This file demonstrates that non-terminating definitions are properly rejected
;; when using the 'def' form (which requires totality).
;;
;; Expected behavior:
;; - Total definitions with structural recursion via recursors should PASS
;; - Partial definitions are allowed to be non-terminating
;; - Total definitions without structural decrease should FAIL

;; Define Nat (self-contained test)
(inductive Nat (sort 0)
  (ctor zero Nat)
  (ctor succ (pi n Nat Nat))
)

(inductive Bool (sort 0)
  (ctor true Bool)
  (ctor false Bool)
)

;; SHOULD PASS: Total definition using recursor (structural recursion)
;; isZero n = Nat.rec (位_. Bool) true (位_ _. false) n
(def isZero (pi n Nat Bool)
  (lam n Nat
    ((((Nat.rec (lam _ Nat Bool)) true) (lam _ Nat (lam _ Bool false))) n)
  )
)

;; SHOULD PASS: Total definition using recursor for predecessor
;; pred n = Nat.rec (位_. Nat) zero (位m _. m) n
(def pred (pi n Nat Nat)
  (lam n Nat
    ((((Nat.rec (lam _ Nat Nat)) zero) (lam m Nat (lam _ Nat m))) n)
  )
)

;; SHOULD PASS: Partial definition is allowed to be non-terminating
(partial maybeLoop (pi n Nat Nat)
  (lam n Nat
    ((((Nat.rec (lam _ Nat Nat)) zero) (lam m Nat (lam _ Nat m))) n)
  )
)

;; Test expressions
(isZero zero)
(isZero (succ zero))
(pred (succ (succ zero)))
